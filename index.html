<!DOCTYPE html>
<html>
<head><title>Live Face Match</title></head>
<body>
    <h1>Live Face Recognition (Direct API)</h1>
    <video id="webcam" autoplay muted width="640" height="480" style="border: 1px solid black;"></video>
    <p id="result" style="font-weight: bold; font-size: 1.2em;">Result: Initializing...</p>

    <script>
        window.onload = async function() {
            // Replace with your Ngrok URL and API Key
            const url = "https://shaniqua-unimparted-subarticulately.ngrok-free.dev"; 
            const api_key = "df0463f7-57a6-4e72-9fae-7ea2c5a32e37";
            const endpoint = `${url}/api/v1/recognition/recognize`;

            async function startWebcam() {
                const video = document.getElementById('webcam');
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    video.srcObject = stream;
                    document.getElementById('result').innerText = "Status: Scanning...";

                    setInterval(async () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        canvas.getContext('2d').drawImage(video, 0, 0);
                        
                        canvas.toBlob(async (blob) => {
                            const formData = new FormData();
                            formData.append('file', blob);

                            try {
                                const response = await fetch(endpoint, {
                                    method: 'POST',
                                    headers: { 'x-api-key': api_key },
                                    body: formData
                                });
                                const data = await response.json();

                                if (data.result && data.result[0].subjects.length > 0) {
                                    const subject = data.result[0].subjects[0].subject;
                                    document.getElementById('result').innerText = "Match: " + subject;
                                    document.getElementById('result').style.color = "green";
                                } else {
                                    document.getElementById('result').innerText = "Searching...";
                                    document.getElementById('result').style.color = "black";
                                }
                            } catch (err) {
                                console.log("API Error:", err);
                                document.getElementById('result').innerText = "Connection Error: Check Ngrok.";
                            }
                        }, 'image/jpeg');
                    }, 3000);
                } catch (err) {
                    document.getElementById('result').innerText = "Camera Error: " + err.message;
                }
            }
            startWebcam();
        };
    </script>
</body>
</html>
