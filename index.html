<!DOCTYPE html>
<html>
<head>
    <title>Live Face Match</title>
    <!-- Include the CompreFace SDK from CDN -->
<script src="https://cdn.jsdelivr.net/npm/@exadel/compreface-js-sdk@0.7.1/dist/compreface-js-sdk.min.js"></script>
</head>
<body>
    <h1>Live Face Recognition</h1>
    <video id="webcam" autoplay muted width="640" height="480"></video>
    <p id="result">Result: Waiting...</p>

    <script>
     window.onload = function() {
    // 1. Find the SDK on the window. It might be under different names.
    const SDK_Object = window.compreface_js_sdk || window.CompreFace || window;

    // 2. Check if CompreFace exists in that object
    if (typeof SDK_Object.CompreFace === 'undefined') {
        document.getElementById('result').innerText = "Error: CompreFace SDK not found. Check Console (F12).";
        console.error("Available window properties:", Object.keys(window).filter(k => k.toLowerCase().includes('compre')));
        return;
    }

    const url = "https://shaniqua-unimparted-subarticulately.ngrok-free.dev"; 
    const port = 443; 
    const api_key = "df0463f7-57a6-4e72-9fae-7ea2c5a32e37";

    // 3. Initialize using the discovered constructor
    const compreFace = new SDK_Object.CompreFace(url, port);
    const recognitionService = compreFace.initFaceRecognitionService(api_key);

    console.log("CompreFace Initialized successfully!");

    async function startWebcam() {
        const video = document.getElementById('webcam');
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            
            // Send a frame to the cloud every 3 seconds
            setInterval(async () => {
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                
                canvas.toBlob((blob) => {
                    recognitionService.recognize(blob)
                        .then(res => {
                            if (res.result && res.result[0].subjects.length > 0) {
                                document.getElementById('result').innerText = "Match: " + res.result[0].subjects[0].subject;
                            } else {
                                document.getElementById('result').innerText = "Scanning... No face detected.";
                            }
                        })
                        .catch(err => console.log("API Error:", err));
                }, 'image/jpeg');
            }, 3000);
        } catch (err) {
            document.getElementById('result').innerText = "Camera Error: " + err.message;
        }
    }

    startWebcam();
};
    </script>
</body>
</html>
